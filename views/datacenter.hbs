
	<header id="header">
        <div class="navbar navbar-inverse" role="banner">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                    <a class="navbar-brand" href="/">
                        <h1><img src="images/logo.png" alt="logo"></h1>
                    </a>

                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="/">Home</a></li>
                        <li><a href="/team">The Team</a></li>
                        <li><a href="/publications">Publications</a></li>
                        <li class="active"><a href="/datacenter">Data Center</a></li>
                        <li><a href="http://oprs.pesitsouthscibase.org">OPRS</a></li>
                    </ul>
                    </ul>
                </div>
                <div class="search">
                    <form role="form">
                        <i class="fa fa-search"></i>
                        <div class="field-toggle">
                            <input type="text" class="search-form" autocomplete="off" placeholder="Search">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </header>
    <!--/#header-->


    <section id="page-breadcrumb">
        <div class="vertical-center sun">
             <div class="container">
                <div class="row">
                    <div class="action">
                        <div class="col-sm-12">
                            <h1 class="title">Data Center</h1>
                            <p>Here you can access SciBase database. An exhaustive repository of Journals with respective Articles and Author information.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--/#action-->

    <section id="blog" class="padding-top padding-bottom">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                  <ul class="nav nav-tabs nav-justified">
                    <li class="active"><a data-toggle="tab" href="#other-datasets">Other Datasets</a></li>
                    <li><a data-toggle="tab" href="#articles">Articles</a></li>
                  </ul>
                </div>
            </div>

            <div class="tab-content">
            <!-- Articles Tab -->
                <div class="tab-pane fade article-search" id="articles">
                    <div class="row selection-row">
                        <div class = "container">
                            <div class="col-sm-3">
                                <select class="test-select" id="journal">
                                    <option value = "all" selected>All Journals</option>
                                    {{#each dataset.journal_data}}
                                        <option value="{{name}}"> {{name}} </option>
                                    {{else}}
                                        <option value="0">No data</option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="col-sm-3">
                                <select class="test-select" id="author">
                                    <option value = "all" selected>All Authors</option>
                                    {{#each dataset.author_data}}
                                        <option value="{{name}}"> {{capitalize name}} </option>
                                    {{else}}
                                        <option value="0">No data</option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="col-sm-3">
                                <select class="test-select" id="country">
                                    <option value = "all" selected>All Countries</option>
                                    {{#each dataset.country_data}}
                                        <option value="{{name}}"> {{capitalize name}} </option>
                                    {{else}}
                                        <option value="0">No data</option>
                                    {{/each}}
                                </select>
                            </div>
                            <div class="col-sm-3">
                                <select class="test-select" id="year">
                                    <option value = "all" selected>All Years</option>
                                    {{#each dataset.year_data}}
                                        <option value="{{year}}"> {{year}} </option>
                                    {{else}}
                                        <option value="0">No data</option>
                                    {{/each}}
                                </select>
                            </div>

                        </div>
                    </div>

                    <div class="row" style = "margin-top:10px;">
                        <div class="container">
                            <button class="btn btn-md btn-primary pull-right" id="download-data"><span class="fa fa-download"></span> Download Data</button>
                            <a href="#"  id="downloadHidden" style="display:none;" download></a>
                        </div>
                    </div>
                  <!--  <div class="loading"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></div> -->
                    <div class="row table-row">
                        <div class="container">
                            <table id="article-table" class="table table-hover">
                                <thead>
                                  <tr>
                                    <th>TITLE</th>
                                    <th>DOI</th>
                                    <th>MONTH</th>
                                    <th>YEAR</th>

                                  </tr>
                                </thead>
                                <tbody>
                                    {{#each dataset.article_data}}
                                      <tr>
                                        <td>{{title}}</td>
                                        <td>{{doi}}</td>
                                        <td>{{month}}</td>
                                        <td>{{year}}</td>

                                      </tr>
                                    {{/each}}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!--Captcha Modal -->
                <div id="captcha-modal" class="modal fade" role="dialog">
                  <div class="modal-dialog modal-sm">

                    <!-- Modal content-->
                    <div class="modal-content">
                      <!--<div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                      </div>-->
                      <div class="modal-body">
                        <div class="row">
                            <div class="col-sm-12" id="captcha-container">
                                {{{captcha.data}}}
                            </div>
                            <div class="col-sm-12 form-group has-feedback" id="captcha-text-container">
                                <input type = "text" class="input input-sm form-control" placeholder = "Enter the above text" id="captcha-text">
                            </div>
                        </div>

                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-success" id="submit-captcha">Submit</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                      </div>
                    </div>

                  </div>
                </div>
                <div class="row tab-pane fade in active padding-top" id="other-datasets">
                    <div class="buttons" style="text-align: center;">
                        <button class="scibase-button">SciBase Datasets</button>
                        <button class="aminer-button">AMiner</button>
                        <button class="scimago-button">Scimago</button>
                        <a href="/query_builder"><button class="dynamic-button">Dynamic Generator</button></a>
                    </div>
                    <div class="masonery_area">
                        {{#each datasets}}
                            <div class="col-md-3 col-sm-4 data-box {{category}} none">
                                <div class="single-blog two-column">
                                    <div class="post-content overflow first-set">
                                        <h2 class="post-title bold data-box-title">{{title}}</h2>
                                        <p class="data-box-description">
                                            {{description}}
                                        </p>
                                        <a href="#" class="read-more download-dataset-data" title="{{size}}" id="{{id}}">Download ({{format}})</a>
                                        <div class="post-bottom overflow">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {{/each}}
						<a href="#" style="display:none;" id="datasetHidden"></a>

                        <!--<div class="col-md-3 col-sm-4 data-box dynamic-dataset none">
                            <div class="single-blog two-column">
                                <div class="post-content overflow">
                                    <ul class="nav nav-justified post-nav">
                                    </ul>
                                    <h2 class="post-title bold data-box-title">Dynamic Generator</h2>
                                    <p class="data-box-description">Now you can download a dynamic dataset from our database.</p>
                                    <a href="/custom_datasets" class="read-more">Click here!</a>
                                    <div class="post-bottom overflow">
                                    </div>
                                </div>
                            </div>
                        </div> -->

                        <div class="col-md-3 col-sm-4 data-box extra-dataset none">
                            <div class="single-blog two-column">
                                <div class="post-content overflow">
                                    <ul class="nav nav-justified post-nav">
                                    </ul>
                                    <h2 class="post-title bold data-box-title">Amnier API Details</h2>
                                    <p class="data-box-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. </p>
                                    <a href="/aminerAPI" class="read-more">Click here!</a>
                                    <div class="post-bottom overflow">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>

    <script type="text/javascript" src="/javascripts/select2.full.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.dynatable.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">

        function capitalize(str) {
            return (str + '').replace(/^([a-z])|\s+([a-z])/g, function ($1) {
                return $1.toUpperCase();
            });
        }

        $(document).ready(function(){

            var socket = io();
            $(".test-select").select2({
                theme:"bootstrap"
            });
            $(".test-select>option").css("textTransform", "capitalize");
            $('#article-table').dynatable();

            $(".test-select").on("change", function(e){
                var filterSearch = {};
                filterSearch.journal = $("#journal").val();
                filterSearch.author = $("#author").val();
                filterSearch.country = $("#country").val();
                filterSearch.year = $("#year").val();
                console.log("here");
                socket.emit('filterSearch_request', filterSearch);
                console.log("emmited");

            });
            var articleData = {{{parseJson dataset.article_data}}};

            socket.on('filterSearch_response', function(filterResult){
                console.log("responded");
                articleData = filterResult.article_data;

                var select2AuthorVal = $("#author").val();

                var select2AuthorList= '<option value="all">All Authors</option>';
                $.each(filterResult.author_data, function(i, item){
                    select2AuthorList += '<option value="'+item.name+'"';
                    select2AuthorList += (item.name == select2AuthorVal)?'selected':' ';
                    select2AuthorList += '>'+capitalize(item.name)+'</option>';
                });

                $("#author").html(" ").promise().done(function(){
                    $("#author").html(select2AuthorList);
                });

                var select2YearVal= $("#year").val();
                var select2YearList= '<option value="all">All Years</option>';
                $.each(filterResult.year_data, function(i, item){
                    select2YearList += '<option value="'+item.year+'"';
                    select2YearList += (item.year == select2YearVal)?'selected':' ';
                    select2YearList += '>'+item.year+'</option>';
                });

                $("#year").html(" ").promise().done(function(){
                    $("#year").html(select2YearList);
                });

                var dynatable = $('#article-table').dynatable({
                    dataset : {
                        records : filterResult.article_data
                    },
                    features:{
                        pushState:false
                    }
                }).data('dynatable');

                dynatable.settings.dataset.originalRecords = filterResult.article_data;
                dynatable.process();
                $(".test-select").css("textTransform", "capitalize");




            });

            var ctrArticleRequested = 0;
			var ctrStaticRequested = 0;
            var datasetId = "";
            $("#download-data").click(function(){
                socket.emit("request_captcha");
				ctrArticleRequested = 1;

            });
			$(".download-dataset-data").click(function(e){
                e.preventDefault();
				socket.emit("request_captcha");
				ctrStaticRequested = 1;
                datasetId = $(this).attr("id");
			});

            socket.on("response_captcha", function(response){
                $("#captcha-container").html(response.data);

                $("#captcha-modal").modal();

                $("#captcha-modal #submit-captcha").click(function(){
                    var t = $("#captcha-text").val();
                    var s = $.trim(t);

                    if(s === response.text){
                        console.log("Access Granted");
						if(ctrArticleRequested == 1){
			               socket.emit('downloadArticleData_request', articleData);
						}else if(ctrStaticRequested == 1){
                            console.log("dataset ", datasetId);
							socket.emit('downloadDatasetData_request', datasetId);
						}
                        //socket.emit('downloadArticleData_request', articleData);
                        console.log("sent download request");
                        $("#captcha-modal").modal("hide");
							ctrStaticRequested = 0;
							ctrArticleRequested = 0;
                    }else{
                        console.log("Access Denied");
                        $("#captcha-text-container").addClass("has-error");
                    }
                });
            });
            socket.on("downloadArticleData_response", function(response){
                console.log("recieved download response");
                $("#downloadHidden").attr("href",response.csv_url);
                $("#downloadHidden")[0].click();
            });

            socket.on("downloadDatasetData_response", function(response){
                $("#datasetHidden").attr("href", response.link);
                $("#datasetHidden")[0].click();
            });

        });
    </script>
    <!--/#blog-->

    <footer id="footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-12 text-center bottom-separator">
                    <img src="images/home/under.png" class="img-responsive inline" alt="">
                </div>
                <div class="col-md-4 col-sm-6">
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="contact-info bottom">
                        <h2>Contacts</h2>
                        <address>
                        E-mail: <a href="mailto:scibase@pes.edu">scibase@pes.edu</a> <br>
                        </address>

                        <h2>Address</h2>
                        <address>
                        PES Institute of Technology - Bangalore South Campus <br>
                        Hosur Road, <br>
                        (1km before Electronic City), <br>
                        Bangalore KA - 560100 <br>
                        </address>
                    </div>
                </div>
                <div class="col-md-4 col-sm-12">
                    <div class="contact-form bottom">
                        <h2>Send a message</h2>
                        <form id="main-contact-form" name="contact-form" method="post" action="sendemail.php">
                            <div class="form-group">
                                <input type="text" name="name" class="form-control" required="required" placeholder="Name">
                            </div>
                            <div class="form-group">
                                <input type="email" name="email" class="form-control" required="required" placeholder="Email Id">
                            </div>
                            <div class="form-group">
                                <textarea name="message" id="message" required="required" class="form-control" rows="8" placeholder="Your text here"></textarea>
                            </div>
                            <div class="form-group">
                                <input type="submit" name="submit" class="btn btn-submit" value="Submit">
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-sm-12">
                    <div class="copyright-text text-center">
                        <p>&copy; SciBase | PES Institute of Technology - Bangalore South Campus. All Rights Reserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <div class = "row">
        <div class="col-sm-12">
            <div class="pull-right text-center">
                <p>Total Downloads : {{datasets.articlesDownloadHits}}</p>
            </div>
        </div>
    </div>
    <!--/#footer-->
